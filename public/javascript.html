<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Tech Chat | Javascript</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />
    <style>
      form {
        padding: 20px;
        position: fixed;
        bottom: 0;
        width: 100%;
        padding-right: 50px;
      }
      #messages {
        list-style-type: none;
        margin: 0;
        padding: 0;
        width: 100%;
      }
      #messages li {
        padding: 5px 10px;
      }
      #messages li:nth-child(odd) {
        background: #eee;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <ul id="messages"></ul>
      </div>
      <div class="row">
        <div class="col-lg-6">
          <form action="">
            <div class="input-group">
              <input id="m" autocomplete="off" type="text" class="form-control" placeholder="Message..." aria-label="Message..." />
              <span class="input-group-btn">
                <button class="btn btn-secondary" type="submit">Send</button>
              </span>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      // Vraag om een username en sla hem op, join de "tech" socket en geef aan dat de room "javascript" is
      const user = prompt('Please enter your username');
      const socket = io('/tech');
      const room = 'javascript';

      // Wanneer je een bericht stuurt stuur je de msg, room en user mee en haal je de oude input weg uit de chat balk
      $('form').submit(() => {
        let msg = $('#m').val();

        socket.emit('message', { msg, room, user });
        $('#m').val('');
        return false;
      });

      // Wanneer je connect stuur dan een join message met de room zodat de server je in de juiste room plaatst en wacht op een reactie met de history terug
      socket.on('connect', () => {
        socket.emit('join', { room, user }, (ack) => {
          // Als je de history terug hebt plaats die dan bovenaan in de huidige chat
          ack.forEach((msg) => {
            $('#messages').append($('<li>').text(`${msg.user_name}: ${msg.chat_text}`));
          });
        });
      });

      // Als er een message binnenkomt zet die in de chat
      socket.on('message', (data) => {
        $('#messages').append($('<li class="message">').text(`${data.user}: ${data.msg}`));
      });

      // Als iemand joint zet een message in de chat
      socket.on('join', (data) => {
        $('#messages').append($('<li class="connect">').text(data));
      });

      // Als iemand disconnect zet een message in de chat
      socket.on('disconnect', (data) => {
        $('#messages').append($('<li class="disconnect">').text(data));
      });
    </script>
  </body>
</html>
